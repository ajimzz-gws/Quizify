<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quizify</title>
  <link rel="stylesheet" href="dashboard1.css"/>
</head>

<body>
  <header>
    <div class="logo">
      <img src="images/quizify2.png" alt="Quizify Logo">
    </div>

    <nav id="navbar">
      <ul>
        <li class="dropdown">
          <a href="javascript:void(0)" onclick="toggleDropdown()" class="dropdown-toggle">Dashboard â–¾</a>
          <ul id="dashboardDropdown" class="dropdown-menu">
            <li><a href="#" id="dashboard-student">Dashboard Student</a></li>
            <li><a href="#" id="dashboard-teacher">Dashboard Teacher</a></li>
          </ul>
        </li>
        <li><a href="#" id="my-quizzes">My Quizzes</a></li>
        <li><a href="#" id="result-link">Result</a></li>
        <li><a href="#" id="logout-btn">Logout</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>Welcome Back!</h2>
    <section id="dashboard">
      <div class="dash-container">
        <div class="total"><h3>Total Quizzes</h3><p>Loading...</p></div>
        <div class="attempts"><h3>Attempts</h3><p>Loading...</p></div>
        <div class="avg"><h3>Average Score</h3><p>Loading...</p></div>
      </div>
    </section>
    <h2>Recent Activity:</h2> 
  </main>

  <script>
    // Function to toggle the dashboard dropdown menu
    function toggleDropdown() {
      const dropdown = document.getElementById("dashboardDropdown");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    }

    document.addEventListener("DOMContentLoaded", function () {
      // --- Dashboard Navigation & Role Switching ---
      const dashboardStudentLink = document.getElementById("dashboard-student");
      const dashboardTeacherLink = document.getElementById("dashboard-teacher");

      if (dashboardStudentLink) {
        dashboardStudentLink.addEventListener("click", function () {
          window.location.href = "dashboardStudent.html";
        });
      }

      if (dashboardTeacherLink) {
        dashboardTeacherLink.addEventListener("click", function () {
          window.location.href = "dashboardTeachers.html";
        });
      }

      // --- Header Navigation Buttons ---
      const myQuizzesLink = document.getElementById("my-quizzes");
      const resultLink = document.getElementById("result-link");
      const logoutButton = document.getElementById("logout-btn");

      if (myQuizzesLink) {
        myQuizzesLink.addEventListener("click", function (e) {
          e.preventDefault();
          window.location.href = "myQuizzes.html";
        });
      }

      if (resultLink) {
        resultLink.addEventListener("click", function (e) {
          e.preventDefault();
          window.location.href = "quizResult.html";
        });
      }

      if (logoutButton) {
        logoutButton.addEventListener("click", function (e) {
          e.preventDefault();
          // Optional: clear session or token here before redirecting
          alert("You have been logged out.");
          window.location.href = "login.html";
        });
      }

      // --- Fetch Dashboard Data for Student ---
      const totalQuizzesDiv = document.querySelector(".total");
      const attemptsDiv = document.querySelector(".attempts");
      const averageScoreDiv = document.querySelector(".avg");

      if (totalQuizzesDiv && attemptsDiv && averageScoreDiv) {
        fetch("http://localhost:8000/api/dashboard/student")
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            totalQuizzesDiv.innerHTML = `<h3>Total Quizzes</h3><p>${data.total_quizzes}</p>`;
            attemptsDiv.innerHTML = `<h3>Attempts</h3><p>${data.attempts}</p>`;
            averageScoreDiv.innerHTML = `<h3>Average Score</h3><p>${data.average_score}%</p>`;
          })
          .catch(error => {
            console.error("Failed to load dashboard data:", error);
            // Optionally, update the UI to show an error message
            totalQuizzesDiv.innerHTML = `<h3>Total Quizzes</h3><p>Error</p>`;
            attemptsDiv.innerHTML = `<h3>Attempts</h3><p>Error</p>`;
            averageScoreDiv.innerHTML = `<h3>Average Score</h3><p>Error</p>`;
          });
      } else {
        console.warn("One or more dashboard data elements not found.");
      }

      // --- Close dropdown when clicking outside ---
      document.addEventListener("click", function (event) {
        const toggle = document.querySelector(".dropdown-toggle");
        const menu = document.getElementById("dashboardDropdown");
        if (toggle && menu && !toggle.contains(event.target) && !menu.contains(event.target)) {
          menu.style.display = "none";
        }
      });
    });
  </script>
</body>
</html>